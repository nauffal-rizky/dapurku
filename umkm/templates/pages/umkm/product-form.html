{% extends '../../layout/base.html' %} {% block content %}
<section class="product-form">
  <article class="content">
    <a href="{% url 'profile' %}" class="back-btn">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="svg-25"
      >
        <path
          fill-rule="evenodd"
          d="M7.28 7.72a.75.75 0 0 1 0 1.06l-2.47 2.47H21a.75.75 0 0 1 0 1.5H4.81l2.47 2.47a.75.75 0 1 1-1.06 1.06l-3.75-3.75a.75.75 0 0 1 0-1.06l3.75-3.75a.75.75 0 0 1 1.06 0Z"
          clip-rule="evenodd"
        /></svg
      >Kembali ke halaman profil</a
    >

    <!-- POPUP -->
    <div class="popup-prompt hidden">
      <div class="popup-box">
        <span>Produk minimal memiliki 1 stock!</span>
        <button class="confirm-btn">Ok</button>
      </div>
    </div>

    <!-- JUDUL -->
    <h1 class="judul">
      {% if product %}Edit Produk{% else %}Tambah Produk Baru{% endif %}
    </h1>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="main-details">
        <div class="img-box">
          {% if product and product.image %}
          <img src="{{ product.image.url }}" alt="product-img" />
          {% else %}
          <img src="/static/img/1.jpg" alt="product-img" />
          {% endif %}
          <label for="id_image">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"
              />
            </svg>
            {{ form.image }}
          </label>
        </div>
        <div class="inputs">
          <div class="input-box">{{ form.name.label_tag }} {{ form.name }}</div>
          <div class="input-box">
            {{ form.price.label_tag }} {{ form.price }}
          </div>
          <div class="input-box">
            {{ form.category.label_tag }} {{ form.category }}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="svg-20"
            >
              <path
                fill-rule="evenodd"
                d="M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
          <div class="input-box">
            {{ form.stock.label_tag }} {{ form.stock }}
          </div>
          <div class="check-box">
            {{ form.is_available.label_tag }} {{ form.is_available }}
          </div>
        </div>
        <div class="desc-box">
          {{ form.description.label_tag }} {{ form.description }}
        </div>
      </div>

      <button type="submit">
        {% if product %}Edit Produk{% else %}Tambah Produk{% endif %}
      </button>
    </form>
  </article>
</section>
{% endblock %} {% block script %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    /* IMAGE */
    const profileImagePreview = document.querySelector("form img");
    document.querySelector("#id_image").addEventListener("change", function () {
      const file = this.files[0];

      if (!file) {
        profileImagePreview.src = "";
        profileImagePreview.style.display = "none";
        return;
      }

      if (!file.type.startsWith("image/")) {
        alert("Please select a valid image file.");
        this.value = "";
        profileImagePreview.src = "";
        profileImagePreview.style.display = "none";
        return;
      }

      const objectURL = URL.createObjectURL(file);

      profileImagePreview.src = objectURL;
      profileImagePreview.style.display = "block";

      profileImagePreview.onload = () => {
        URL.revokeObjectURL(objectURL);
      };

      profileImagePreview.onerror = () => {
        profileImagePreview.src = "";
        profileImagePreview.style.display = "none";
        alert("Failed to load the selected image.");
      };
    });

    /* STOCK */
    const promptPopup = document.querySelector(".popup-prompt");
    const confirmBtn = document.querySelector(".confirm-btn");
    const stockInput = document.querySelector("#id_stock");
    stockInput.addEventListener("change", () => {
      promptPopup.classList.remove("hidden");
      if (stockInput.value == 0) stockInput.value = 1;
    });
    confirmBtn.addEventListener("click", () => {
      promptPopup.classList.add("hidden");
    });
  });
</script>
{% endblock %}
