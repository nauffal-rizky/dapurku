{% extends '../layout/base.html' %}{% block content %}
<section class="cartpage">
  <div class="content">
    <a href="{% url 'products' %}" class="back-btn"
      ><i class="fa-solid fa-arrow-left"></i>Kembali ke halaman produk</a
    >
    <div class="desc">
      <span
        >Ada <span class="amount">sekian</span> produk di keranjang belanja
        Anda</span
      >
      <label class="select-all"
        ><input type="checkbox" name="" />
        <div class="checkbox"><i class="fa-solid fa-check"></i></div>
        Pilih semua</label
      >
    </div>
    <div class="cart-products">
      <div class="product-info">
        <label>
          <input type="checkbox" />
          <div class="checkbox"><i class="fa-solid fa-check"></i></div>
        </label>
        <div class="purchase-details">
          <img src="/static/logo.png" alt="product_img" />
          <div class="desc">
            <span>Produk 1</span>
            <span>Varian: Varian Produk 1</span>
            <span>Harga satuan: Rp 1.234.56</span>
          </div>
          <div class="stock">
            <i class="fa-solid fa-circle stocked"></i>
            <span>Stok: 99</span>
          </div>
          <div class="quantity">
            <button><i class="fa-solid fa-minus"></i></button>
            <span>3</span>
            <button><i class="fa-solid fa-plus"></i></button>
          </div>
          <span class="total-price">Rp 7.890</span>
        </div>
      </div>
      <div class="product-info">
        <label>
          <input type="checkbox" />
          <div class="checkbox"><i class="fa-solid fa-check"></i></div>
        </label>
        <div class="purchase-details">
          <img src="/static/logo.png" alt="product_img" />
          <div class="desc">
            <span>Produk 2</span>
            <span>Varian: Varian Produk 2</span>
            <span>Harga satuan: Rp 1.234.56</span>
          </div>
          <div class="stock">
            <i class="fa-solid fa-circle almost_run_out"></i>
            <span>Stok: 99</span>
          </div>
          <div class="quantity">
            <button><i class="fa-solid fa-minus"></i></button>
            <span>3</span>
            <button><i class="fa-solid fa-plus"></i></button>
          </div>
          <span class="total-price">Rp 7.890</span>
        </div>
      </div>
      <div class="product-info">
        <label>
          <input type="checkbox" />
          <div class="checkbox"><i class="fa-solid fa-check"></i></div>
        </label>
        <div class="purchase-details">
          <img src="/static/logo.png" alt="product_img" />
          <div class="desc">
            <span>Produk 3</span>
            <span>Varian: Varian Produk 3</span>
            <span>Harga satuan: Rp 1.234.56</span>
          </div>
          <div class="stock">
            <i class="fa-solid fa-circle run_out"></i>
            <span>Stok: 99</span>
          </div>
          <div class="quantity">
            <button><i class="fa-solid fa-minus"></i></button>
            <span>3</span>
            <button><i class="fa-solid fa-plus"></i></button>
          </div>
          <span class="total-price">Rp 7.890</span>
        </div>
      </div>
      {% comment %} {% for item in cart_items %} --BARU--
      <div class="product-info">
        <label>
          <input type="checkbox" />
          <div class="checkbox"><i class="fa-solid fa-check"></i></div>
        </label>
        <div class="purchase-details">
          <img src="{{ item.product.image.url }}" alt="product_img" />
          <div class="desc">
            <span>{{ item.product.name }}</span>
            {% if item.variant %}
            <span>Varian: {{ item.variant.name }}</span>
            {% endif %}
            <span>Harga satuan: Rp {{ item.product.price|floatformat:0 }}</span>
          </div>
          <div class="stock">
            <i class="fa-solid fa-circle"></i>
            <span>Stok: {{ item.product.stock }}</span>
          </div>
          <div class="quantity">
            <button><i class="fa-solid fa-minus"></i></button>
            <span>{{ item.quantity }}</span>
            <button><i class="fa-solid fa-plus"></i></button>
          </div>
          <span class="total-price"
            >Rp {{ item.total_price|floatformat:0 }}</span
          >
        </div>
      </div>
      {% empty %}
      <p>Keranjang belanja Anda kosong.</p>
      {% endfor %} {% endcomment %}
    </div>
    <span>Sub Total: <span class="subtotal underline-text">0</span></span>
    <div class="btn-container">
      <a href="{% url 'products' %}">Kembali belanja</a>
      <a href="{% url 'order' %}">Pesan</a>
    </div>
  </div>
</section>
{% endblock %} {% block script %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const products = document.querySelectorAll(
      ".cartpage .content .cart-products .product-info"
    );
    const amount = document.querySelector(".cartpage .content .desc .amount");
    amount.textContent = products.length;

    const selectAllCheckbox = document.querySelector(".select-all input");
    const itemCheckboxes = document.querySelectorAll(
      ".product-info label input"
    );

    selectAllCheckbox.addEventListener("change", () => {
      itemCheckboxes.forEach((checkbox) => {
        checkbox.checked = selectAllCheckbox.checked;
      });
    });

    itemCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        if (!checkbox.checked) {
          selectAllCheckbox.checked = false;
        } else {
          const allChecked = Array.from(itemCheckboxes).every(
            (cb) => cb.checked
          );
          selectAllCheckbox.checked = allChecked;
        }
      });
    });

    const minusButtons = document.querySelectorAll(
      ".quantity button:first-of-type"
    );
    const plusButtons = document.querySelectorAll(
      ".quantity button:last-of-type"
    );
    const quantitySpans = document.querySelectorAll(".quantity span");
    const totalPriceSpans = document.querySelectorAll(".total-price");
    const unitPriceSpans = document.querySelectorAll(
      ".purchase-details .desc span:nth-of-type(3)"
    );
    const subtotalSpan = document.querySelector(".subtotal");

    const updateSubtotal = () => {
      let subtotal = 0;
      totalPriceSpans.forEach((span) => {
        const priceText = span.textContent
          .replace("Rp ", "")
          .replace(/\./g, "");
        subtotal += parseInt(priceText);
      });
      subtotalSpan.textContent = `Rp${subtotal.toLocaleString("id-ID")}`;
    };

    minusButtons.forEach((button, index) => {
      button.addEventListener("click", () => {
        let quantity = parseInt(quantitySpans[index].textContent);
        if (quantity > 1) {
          quantity--;
          quantitySpans[index].textContent = quantity;
          const unitPriceText = unitPriceSpans[index].textContent
            .replace("Harga satuan: Rp ", "")
            .replace(/\./g, "");
          const unitPrice = parseInt(unitPriceText);
          const totalPrice = unitPrice * quantity;
          totalPriceSpans[index].textContent = `Rp ${totalPrice.toLocaleString(
            "id-ID"
          )}`;
          updateSubtotal();
        }
      });
    });
    plusButtons.forEach((button, index) => {
      button.addEventListener("click", () => {
        let quantity = parseInt(quantitySpans[index].textContent);
        quantity++;
        quantitySpans[index].textContent = quantity;
        const unitPriceText = unitPriceSpans[index].textContent
          .replace("Harga satuan: Rp ", "")
          .replace(/\./g, "");
        const unitPrice = parseInt(unitPriceText);
        const totalPrice = unitPrice * quantity;
        totalPriceSpans[index].textContent = `Rp ${totalPrice.toLocaleString(
          "id-ID"
        )}`;
        updateSubtotal();
      });
    });

    updateSubtotal();
  });
</script>
{% endblock %}
